//ReadThis by Santiago Callejas
//https://github.com/sancagon87/ReadThis
(function(b){function s(a){for(var c=[],g=[],d=a.data("opciones").array.length,k=q.length,e=0;e<d;e++)c[e]=new Image,b(c[e]).load(function(){a.data("porcentage",a.data("porcentage")+1)}).attr({src:a.data("opciones").array[e]}).error(function(){alert("Error! No se puede cargar una imagen! Recargar la pagina!")});for(e=0;e<k;e++)g[e]=new Image,b(g[e]).load(function(){a.data("porcentage",a.data("porcentage")+1)}).attr({src:q[e]}).error(function(){alert("Error! No se puede cargar una imagen! Recargar la pagina!")});
a.data("imagenes",c)}function p(a){for(var c=a.contents("#0"),g=0,d=0,k=0,e,m,f=a.data("opciones").width,h=a.data("opciones").height;0<c.length;)c.hasClass("doble")||0==g||c.hasClass("single")?(e=r(f,h,a.data("imagenes")[g].width,a.data("imagenes")[g].height),c.css({width:e.w,height:e.h}),k++,g++):c.hasClass("izquierda")&&(e=r(f,h,a.data("imagenes")[g].width,a.data("imagenes")[g].height),c.next().hasClass("relleno")?(c.next().css("width",f/2),c.next().css("height",h),m=e):0<c.next().length?(m=r(f,
h,a.data("imagenes")[g+1].width,a.data("imagenes")[g+1].height),g++):m={W:0,h:0},e+m>f&&(e={w:f/2,h:h},m={w:f/2,h:h}),c.css({width:e.w,height:e.h}),c.next().css({width:m.w,height:m.h}),g++),c=c.next(),d++;"single"==a.data("opciones").pages?a.data("cantPags",k):a.data("cantPags",(d+k)/2);a.contents().each(function(){"standard"==a.data("opciones").mode?b(this).hasClass("izquierda")?b(this).css({right:f/2,left:""}):b(this).hasClass("derecha")||b(this).hasClass("relleno")?b(this).css({left:f/2,right:""}):
(b(this).hasClass("doble")||"single"==a.data("opciones").pages)&&b(this).css({left:(f-b(this).width())/2}):"manga"==a.data("opciones").mode&&(b(this).hasClass("izquierda")?b(this).css({left:f/2,right:""}):b(this).hasClass("derecha")||b(this).hasClass("relleno")?b(this).css({right:f/2,left:""}):(b(this).hasClass("doble")||"single"==a.data("opciones").pages)&&b(this).css({left:(f-b(this).width())/2}))});b("#RTprogbar").css({left:(a.data("opciones").width-b("#progbar").width())/2});l(a)}function r(a,
b,g,d){return d>b?b*g/d>a?{w:a,h:Math.round(a*d/g)}:{w:Math.round(b*g/d),h:b}:g>a?{w:a,h:Math.round(a*d/g)}:{w:g,h:d}}function t(a){a.dblclick(function(b){b.pageX>=a.width()/2?a.flipPage("right"):a.flipPage("left")});b(document).keyup(function(c){switch(c.which){case 37:a.flipPage("left");break;case 39:a.flipPage("right");break;case 70:a.RTtoogleFS();break;case 49:a.data("zoomlvl",100);b("#RTzoom").css("background-image","url('"+h[0]+"')");l(a);break;case 50:a.data("zoomlvl",150);b("#RTzoom").css("background-image",
"url('"+h[1]+"')");l(a);break;case 51:a.data("zoomlvl",200);b("#RTzoom").css("background-image","url('"+h[2]+"')");l(a);break;case 52:a.data("zoomlvl",250);b("#RTzoom").css("background-image","url('"+h[3]+"')");l(a);break;case 90:a.RTtoogleZOOM();break;case 77:"standard"==a.data("opciones").mode?a.data("opciones").mode="manga":a.data("opciones").mode="standard",p(a)}});b(document).bind("fscreenopen",function(c){a.data("swapW",a.data("opciones").width);a.data("swapH",a.data("opciones").height);a.data("opciones").width=
b(window).width();a.data("opciones").height=b(window).height();b("#RTfscreen").css("background-image","url('"+n[1]+"')");p(a)});b(document).bind("fscreenclose",function(c){a.data("opciones").width=a.data("swapW");a.data("opciones").height=a.data("swapH");b("#RTfscreen").css("background-image","url('"+n[0]+"')");p(a)});a.mousemove(function(c){var g=a.data("opciones").height,d=a.data("opciones").width,k=a.offset();if(a.data("opciones").zoom){var e=g-b("#ReadThisZOOM").height(),h=d-b("#ReadThisZOOM").width(),
f=g/100,l=d/100;c.pageX>k.left+5&&c.pageX<k.left+d-5&&c.pageY>k.top+5&&c.pageY<k.top+g-5?(b("#ReadThisZOOM").removeClass("hidden"),c.pageY<=20*f?b("#ReadThisZOOM").css("top",0):c.pageY>=20*f&&c.pageY<=80*f?(d=100*(c.pageY-20*f)/(60*f),b("#ReadThisZOOM").css("top",d*e/100)):c.pageY>80*f&&b("#ReadThisZOOM").css("top",e),c.pageX<=20*l?b("#ReadThisZOOM").css("left",0):c.pageX>=20*l&&c.pageX<=80*l?(e=100*(c.pageX-20*l)/(60*l),b("#ReadThisZOOM").css("left",e*h/100)):c.pageX>80*l&&b("#ReadThisZOOM").css("left",
h)):b("#ReadThisZOOM").addClass("hidden")}c.pageY>=k.top+g-40?a.data("panelON")||(a.data("panelON",!0),b("#ReadThisPanel").animate({opacity:1},{duration:500,queue:!1})):a.data("panelON")&&(a.data("panelON",!1),b("#ReadThisPanel").animate({opacity:0},{duration:500,queue:!1}))});b("#ReadThisZOOM").mouseout(function(a){b("#ReadThisZOOM").addClass("hidden")});b("#ReadThisPanel").click(function(b){a.data("opciones");var g=a.data("opciones").width,d=a.offset();b.pageX>=d.left+g-40?a.RTtoogleFS():b.pageX<=
d.left+20?a.RTzoomOut():b.pageX>d.left+20&&b.pageX<=d.left+60?a.RTtoogleZOOM():b.pageX>d.left+60&&b.pageX<=d.left+80&&a.RTzoomIn()})}function l(a){var c=a.contents(".mostrar"),g,d,k=c.first().attr("id"),e=a.data("zoomlvl")/100,h;"standard"==a.data("opciones").mode?(g=b("#RTZ1"),h=b("#RTZ2")):"manga"==a.data("opciones").mode&&(g=b("#RTZ2"),h=b("#RTZ1"));g.css({width:a.data("imagenes")[k].width*e,height:a.data("imagenes")[k].height*e,"background-image":"url('"+a.data("imagenes")[k].src+"')","background-size":"100%",
"float":"left"});g=a.data("imagenes")[k].width*e;d=a.data("imagenes")[k].height*e;c.first().hasClass("doble")||"single"==a.data("opciones").pages||c.first().hasClass("derecha")||c.last().hasClass("relleno")?h.css({width:0,height:0}):(k=c.last().attr("id"),h.css({width:a.data("imagenes")[k].width*e,height:a.data("imagenes")[k].height*e,"background-image":"url('"+a.data("imagenes")[k].src+"')","background-size":"100%","float":"left"}),g+=a.data("imagenes")[k].width*e);b("#ReadThisZOOM").css({width:g,
height:d,"z-index":9E3});b("#RTZhitbox").css({width:g,height:d,"z-index":9E3,position:"absolute"})}var n=["http://imageshack.com/a/img854/2462/ezam.png","http://imageshack.com/a/img836/8787/uw7v.png"],h=["http://imageshack.com/a/img837/4233/7pwk.png","http://imageshack.com/a/img819/8431/lbzu.png","http://imageshack.com/a/img837/8485/a0xs.png","http://imageshack.com/a/img268/8585/t970.png","http://imageshack.com/a/img811/4599/su6h.png"],q=["http://imageshack.com/a/img801/8726/zt.gif","http://imageshack.com/a/img689/7615/fzi4.png",
n[0],n[1],h[0],h[1],h[2],h[3],h[4],"http://imageshack.com/a/img707/7807/310x.png","http://imageshack.com/a/img35/492/ya18.png","http://imageshack.com/a/img17/4806/edn0.png","http://imageshack.com/a/img819/4650/9wpq.png"];b.fn.ReadThis=function(a){b("head").append("<style> .hidden{ display: none !important; visibility: hidden; z-index: -1;} .derecha, .relleno, .doble, .izquierda, .single, #ReadThisZOOM{ position: absolute; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;} .relleno{background-image:url('http://imageshack.com/a/img689/7615/fzi4.png'); background.size:100%;}</style>");
a=b.extend({height:400,width:800,backround_color:"#000",pages:"double",zoom:!0,mode:"standard"},a);this.data("opciones",a);this.data("fullscreen",!1);this.data("zoomlvl",100);void 0==a.backround_img&&this.css("background",a.background_color);this.css({overflow:"hidden",height:a.height,width:a.width,position:"absolute"});var c=this;s(this);this.append("<div id='ReadThisZOOM' class='hidden' style='background-color:rgb(0,0,0);'><div id='RTZhitbox'></div><div id='RTZ1'></div><div id='RTZ2'></div></div>");
this.append("<div id='ReadThisPanel'></div>");this.append("<div id='ReadThisLoader' style='position:absolute; background-color:#000;'><div id='RTLoutput'><p style='color:white; text-align:center; font-size: 20px; font-weight: bold;'></p><img src='http://imageshack.com/a/img801/8726/zt.gif'></img></div></div>");b("#ReadThisLoader").css({width:this.data("opciones").width,height:this.data("opciones").height});b("#RTLoutput").css("margin-top",(this.data("opciones").height-128)/2);b("#RTLoutput img").css({"margin-left":(this.data("opciones").width-
b("#RTLoutput img").width())/2});this.data("porcentage",0);this.data("timer",setInterval(function(){var a=c.data("opciones").array.length+q.length;if(c.data("porcentage")<a)b("#RTLoutput p").text("Cargando: "+Math.round(100/a*c.data("porcentage"))+"%");else{b("#RTLoutput p").text("Carga terminada: 100%");clearInterval(c.data("timer"));b("#ReadThisLoader").addClass("hidden");if("single"==c.data("opciones").pages)for(var a=c.data("opciones").array.length,d=0;d<a;d++)c.append("<div id='"+d+"' class='single hidden'></div>"),
b("#"+d).css({width:c.data("imagenes")[d].width,heigth:c.data("imagenes")[d].height,"background-image":"url('"+c.data("imagenes")[d].src+"')","background-size":"100%"});else{for(var a=c.data("opciones").array.length,d=[],k=!1,e=!0,l=!1,f=0;f<a;f++)c.data("imagenes")[f].width>c.data("imagenes")[f].height?d[f]="doble":d[f]="normal";for(f=0;f<a;f++)"doble"==d[f]?(l=!0,0==(f+1)%2?(k&&c.append("<div class='relleno hidden'></div>"),k=!0):(k||c.append("<div class='relleno hidden'></div>"),k=!1)):l=!1,l?
(e=!1,c.append("<div id='"+f+"' class='doble hidden'></div>")):e?(e=!1,c.append("<div id='"+f+"' class='derecha hidden'></div>")):(e=!0,c.append("<div id='"+f+"' class='izquierda hidden'></div>")),b("#"+f).css({width:c.data("imagenes")[f].width,heigth:c.data("imagenes")[f].height,"background-image":"url('"+c.data("imagenes")[f].src+"')","background-size":"100%"})}c.contents("#0").removeClass("hidden");c.contents("#0").addClass("mostrar");p(c);t(c);c.data("panelON",!1);b("#ReadThisPanel").css({height:40,
width:"100%",position:"absolute",left:0,bottom:0,"z-index":9001,opacity:0,"background-color":"rgba(0,0,0,0.7)"});b("#ReadThisPanel").append("<div id='RTfscreen'></div>");b("#RTfscreen").css({"background-image":"url('"+n[0]+"')","background-size":"100%",width:32,height:32,"float":"right","margin-right":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTzoomOut'></div>");b("#RTzoomOut").css({"background-image":"url('http://imageshack.com/a/img707/7807/310x.png')","background-size":"100%",width:15,
height:15,"float":"left","margin-left":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTzoom'></div>");b("#RTzoom").css({"background-image":"url('"+h[0]+"')","background-size":"100%",width:32,height:32,"float":"left","margin-left":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTzoomIn'></div>");b("#RTzoomIn").css({"background-image":"url('http://imageshack.com/a/img35/492/ya18.png')","background-size":"100%",width:15,height:15,"float":"left","margin-left":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTprogbar'><div id='progtext'></div><div id='progbar'><span></span></div></div>");
b("#progtext").css({color:"#FFFFFF","float":"left","font-family":"Helvetica","margin-right":"5px","margin-top":"10px"});b("#progtext").text("1/"+c.data("cantPags"));c.data("pagActual",1);b("#progbar").css({height:8,width:350,"margin-top":17,"float":"left","background-color":"#3F0000"});b("#progbar span").css({height:8,width:0,"float":"left","background-color":"#FF0000"});b("#RTprogbar").css({height:32,position:"absolute",left:(c.data("opciones").width-b("#progbar").width())/2})}},200))};b.fn.flipPage=
function(a){var c=this.data("opciones").array.length-1;"single"==this.data("opciones").pages?"right"==a&&this.contents(".mostrar").attr("id")!=c?(this.contents(".mostrar").next().addClass("proximo"),this.contents(".mostrar").addClass("hidden"),this.contents(".mostrar").removeClass("mostrar"),this.contents(".proximo").addClass("mostrar"),this.contents(".proximo").removeClass("hidden"),this.contents(".proximo").removeClass("proximo"),this.data("pagActual",this.data("pagActual")+1)):"left"==a&&0!=this.contents(".mostrar").attr("id")&&
(this.contents(".mostrar").prev().addClass("proximo"),this.contents(".mostrar").addClass("hidden"),this.contents(".mostrar").removeClass("mostrar"),this.contents(".proximo").addClass("mostrar"),this.contents(".proximo").removeClass("hidden"),this.contents(".proximo").removeClass("proximo"),this.data("pagActual",this.data("pagActual")-1)):"right"==a&&this.contents(".mostrar").last().attr("id")!=c?(this.contents(".mostrar").last().next().addClass("proximo"),this.contents(".mostrar").last().next().hasClass("doble")||
this.contents(".proximo").next().addClass("proximo"),this.contents(".mostrar").each(function(){b(this).addClass("hidden");b(this).removeClass("mostrar")}),this.contents(".proximo").each(function(){b(this).addClass("mostrar")}),this.contents(".proximo").each(function(){b(this).removeClass("hidden");b(this).removeClass("proximo")}),this.data("pagActual",this.data("pagActual")+1)):"left"==a&&0!=this.contents(".mostrar").first().attr("id")&&(this.contents(".mostrar").first().prev().addClass("proximo"),
this.contents(".mostrar").first().prev().hasClass("doble")||0==this.contents(".mostrar").first().prev().attr("id")||this.contents(".proximo").prev().addClass("proximo"),this.contents(".mostrar").each(function(){b(this).addClass("hidden");b(this).removeClass("mostrar")}),this.contents(".proximo").each(function(){b(this).addClass("mostrar")}),this.contents(".proximo").each(function(){b(this).removeClass("hidden");b(this).removeClass("proximo")}),this.data("pagActual",this.data("pagActual")-1));b("#progtext").text(this.data("pagActual")+
"/"+this.data("cantPags"));b("#progbar span").css("width",(this.data("pagActual")-1)/(this.data("cantPags")-1)*b("#progbar").width());l(this)};b.fn.RTtoogleFS=function(){this.data("fullscreen")?(b.fullscreen.exit(),this.data("fullscreen",!1)):(this.fullscreen(),this.data("fullscreen",!0));b("#ReadThisZOOM").addClass("hidden")};b.fn.RTtoogleZOOM=function(){this.data("opciones").zoom?(this.data("opciones").zoom=!1,b("#ReadThisZOOM").hasClass("hidden")||b("#ReadThisZOOM").addClass("hidden"),b("#RTzoom").css("background-image",
"url('"+h[4]+"')"),b("#RTzoomOut").css("background-image","url('http://imageshack.com/a/img17/4806/edn0.png')"),b("#RTzoomIn").css("background-image","url('http://imageshack.com/a/img819/4650/9wpq.png')")):(this.data("opciones").zoom=!0,b("#RTzoom").css("background-image","url('"+h[(this.data("zoomlvl")-100)/50]+"')"),b("#RTzoomOut").css("background-image","url('http://imageshack.com/a/img707/7807/310x.png')"),b("#RTzoomIn").css("background-image","url('http://imageshack.com/a/img35/492/ya18.png')"))};
b.fn.RTzoomOut=function(){var a=this.data("zoomlvl");100<a&&this.data("opciones").zoom&&(this.data("zoomlvl",a-50),b("#RTzoom").css("background-image","url('"+h[(this.data("zoomlvl")-100)/50]+"')"),l(this))};b.fn.RTzoomIn=function(){var a=this.data("zoomlvl");250>a&&this.data("opciones").zoom&&(this.data("zoomlvl",a+50),b("#RTzoom").css("background-image","url('"+h[(this.data("zoomlvl")-100)/50]+"')"),l(this))}})(jQuery);