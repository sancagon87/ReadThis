//ReadThis by Santiago Callejas
//https://github.com/sancagon87/ReadThis
(function(b){function q(a){for(var c=[],f=a.data("opciones").k.length,d=0;d<f;d++)c[d]=new Image,b(c[d]).load(function(){a.data("porcentage",a.data("porcentage")+1)}).h({src:a.data("opciones").k[d]}).error(function(){alert("Error! No se puede cargar una imagen! Recargar la pagina!")});a.data("imagenes",c)}function p(a){for(var c=a.b("#0"),f=0,d=0,h=0,g,k,e=a.data("opciones").width,l=a.data("opciones").height;0<c.length;)c.d("doble")||0==f||c.d("single")?(g=n(e,l,a.data("imagenes")[f].width,a.data("imagenes")[f].height),
c.a({width:g.g,height:g.f}),h++,f++):c.d("izquierda")&&(g=n(e,l,a.data("imagenes")[f].width,a.data("imagenes")[f].height),c.next().d("relleno")?(c.next().a("width",e/2),c.next().a("height",l),k=g):0<c.next().length?(k=n(e,l,a.data("imagenes")[f+1].width,a.data("imagenes")[f+1].height),f++):k={v:0,f:0},g+k>e&&(g={g:e/2,f:l},k={g:e/2,f:l}),c.a({width:g.g,height:g.f}),c.next().a({width:k.g,height:k.f}),f++),c=c.next(),d++;"single"==a.data("opciones").j?a.data("cantPags",h):a.data("cantPags",(d+h)/2);
a.b().i(function(){"normal"==a.data("opciones").mode?b(this).d("izquierda")?b(this).a({right:e/2,left:""}):b(this).d("derecha")||b(this).d("relleno")?b(this).a({left:e/2,right:""}):(b(this).d("doble")||"single"==a.data("opciones").j)&&b(this).a({left:(e-b(this).width())/2}):"manga"==a.data("opciones").mode&&(b(this).d("izquierda")?b(this).a({left:e/2,right:""}):b(this).d("derecha")||b(this).d("relleno")?b(this).a({right:e/2,left:""}):(b(this).d("doble")||"single"==a.data("opciones").j)&&b(this).a({left:(e-
b(this).width())/2}))});b("#RTprogbar").a({left:(a.data("opciones").width-b("#progbar").width())/2});m(a)}function n(a,b,f,d){return d>b?b*f/d>a?{g:a,f:Math.round(a*d/f)}:{g:Math.round(b*f/d),f:b}:f>a?{g:a,f:Math.round(a*d/f)}:{g:f,f:d}}function r(a){a.C(function(b){b.pageX>=a.width()/2?a.p("right"):a.p("left")});b(document).D(function(c){switch(c.which){case 37:cambiar("left");break;case 39:cambiar("right");break;case 70:a.data("fullscreen")?(b.o.r(),a.data("fullscreen",!1)):(a.o(),a.data("fullscreen",
!0));break;case 49:a.data("opciones").l=100;m(a);break;case 50:a.data("opciones").l=150;m(a);break;case 51:a.data("opciones").l=200;m(a);break;case 52:a.data("opciones").l=300;m(a);break;case 90:a.data("opciones").zoom?(a.data("opciones").zoom=!1,b("#ReadThisZOOM").d("hidden")||b("#ReadThisZOOM").c("hidden")):a.data("opciones").zoom=!0;break;case 77:"normal"==a.data("opciones").mode?a.data("opciones").mode="manga":a.data("opciones").mode="normal",p(a)}});b(document);b(document);a.F(function(c){var f=
a.data("opciones").height,d=a.data("opciones").width,h=a.offset();if(a.data("opciones").zoom){var g=f-b("#ReadThisZOOM").height(),k=d-b("#ReadThisZOOM").width(),e=f/100,l=d/100;c.pageX>h.left+5&&c.pageX<h.left+d-5&&c.pageY>h.top+5&&c.pageY<h.top+f-5?(b("#ReadThisZOOM").e("hidden"),c.pageY<=20*e?b("#ReadThisZOOM").a("top",0):c.pageY>=20*e&&c.pageY<=80*e?(d=100*(c.pageY-20*e)/(60*e),b("#ReadThisZOOM").a("top",d*g/100)):c.pageY>80*e&&b("#ReadThisZOOM").a("top",g),c.pageX<=20*l?b("#ReadThisZOOM").a("left",
0):c.pageX>=20*l&&c.pageX<=80*l?(g=100*(c.pageX-20*l)/(60*l),b("#ReadThisZOOM").a("left",g*k/100)):c.pageX>80*l&&b("#ReadThisZOOM").a("left",k)):b("#ReadThisZOOM").c("hidden")}c.pageY>=h.top+f-40?a.data("panelON")||(a.data("panelON",!0),b("#ReadThisPanel").q({opacity:1},{duration:500,t:!1})):a.data("panelON")&&(a.data("panelON",!1),b("#ReadThisPanel").q({opacity:0},{duration:500,t:!1}))});b("#ReadThisZOOM").G(function(){b("#ReadThisZOOM").c("hidden")});b("#ReadThisPanel").click(function(c){a.data("opciones");
var f=a.data("opciones").width,d=a.offset();c.pageX>=d.left+f-40?(a.data("fullscreen")?(b.o.r(),a.data("fullscreen",!1)):(a.o(),a.data("fullscreen",!0)),b("#ReadThisZOOM").c("hidden")):c.pageX<=d.left+40&&(a.data("opciones").zoom?(a.data("opciones").zoom=!1,b("#ReadThisZOOM").d("hidden")||b("#ReadThisZOOM").c("hidden")):a.data("opciones").zoom=!0)})}function m(a){var c=a.b(".mostrar"),f,d,h=c.first().h("id"),g=a.data("opciones").l/100,k;"normal"==a.data("opciones").mode?(f=b("#RTZ1"),k=b("#RTZ2")):
"manga"==a.data("opciones").mode&&(f=b("#RTZ2"),k=b("#RTZ1"));f.a({width:a.data("imagenes")[h].width*g,height:a.data("imagenes")[h].height*g,"background-image":"url('"+a.data("imagenes")[h].src+"')","background-size":"100%","float":"left"});f=a.data("imagenes")[h].width*g;d=a.data("imagenes")[h].height*g;c.first().d("doble")||"single"==a.data("opciones").j||c.first().d("derecha")||c.m().d("relleno")?k.a({width:0,height:0}):(h=c.m().h("id"),k.a({width:a.data("imagenes")[h].width*g,height:a.data("imagenes")[h].height*
g,"background-image":"url('"+a.data("imagenes")[h].src+"')","background-size":"100%","float":"left"}),f+=a.data("imagenes")[h].width*g);b("#ReadThisZOOM").a({width:f,height:d,"z-index":9E3});b("#RTZhitbox").a({width:f,height:d,"z-index":9E3,position:"absolute"})}b.s.u=function(a){b("head").append("<style> .hidden{ display: none !important; visibility: hidden; z-index: -1;} .derecha, .relleno, .doble, .izquierda, .single, #ReadThisZOOM{ position: absolute; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;} .relleno{background-image:url('img/relleno_tile.jpg'); background.size:100%;}</style>");
a=b.extend({height:400,width:800,A:"#000",j:"single",H:!1,zoom:!0,l:100,mode:"normal"},a);this.data("opciones",a);this.data("fullscreen",!1);void 0==a.B&&this.a("background",a.w);this.a({overflow:"hidden",height:a.height,width:a.width,position:"absolute"});var c=this;q(this);this.append("<div id='ReadThisZOOM' class='hidden' style='background-color:rgb(0,0,0);'><div id='RTZhitbox'></div><div id='RTZ1'></div><div id='RTZ2'></div></div>");this.append("<div id='ReadThisPanel'></div>");this.append("<div id='ReadThisLoader' style='position:absolute; background-color:#000;'><div id='RTLoutput'><p style='color:white; text-align:center; font-size: 20px; font-weight: bold;'></p><img src='http://www.factormetal.com/wp-content/plugins/google-calendar-widget/loading.gif'></img></div></div>");
b("#ReadThisLoader").a({width:this.data("opciones").width,height:this.data("opciones").height});b("#RTLoutput").a("margin-top",(this.data("opciones").height-128)/2);b("#RTLoutput img").a({"margin-left":(this.data("opciones").width-b("#RTLoutput img").width())/2});this.data("porcentage",0);this.data("timer",setInterval(function(){var a=c.data("opciones").k.length;if(c.data("porcentage")<a)b("#RTLoutput p").text("Cargando: "+Math.round(100/a*c.data("porcentage"))+"%");else{b("#RTLoutput p").text("Carga terminada: 100%");
clearInterval(c.data("timer"));b("#ReadThisLoader").c("hidden");if("single"==c.data("opciones").j)for(var a=c.data("opciones").k.length,d=0;d<a;d++)c.append("<div id='"+d+"' class='single hidden'></div>"),b("#"+d).a({width:c.data("imagenes")[d].width,heigth:c.data("imagenes")[d].height,"background-image":"url('"+c.data("imagenes")[d].src+"')","background-size":"100%"});else{for(var a=c.data("opciones").k.length,d=[],h=!1,g=!0,k=!1,e=0;e<a;e++)c.data("imagenes")[e].width>c.data("imagenes")[e].height?
d[e]="doble":d[e]="normal";for(e=0;e<a;e++)"doble"==d[e]?(k=!0,0==(e+1)%2?(h&&c.append("<div class='relleno hidden'></div>"),h=!0):(h||c.append("<div class='relleno hidden'></div>"),h=!1)):k=!1,k?(g=!1,c.append("<div id='"+e+"' class='doble hidden'></div>")):g?(g=!1,c.append("<div id='"+e+"' class='derecha hidden'></div>")):(g=!0,c.append("<div id='"+e+"' class='izquierda hidden'></div>")),b("#"+e).a({width:c.data("imagenes")[e].width,heigth:c.data("imagenes")[e].height,"background-image":"url('"+
c.data("imagenes")[e].src+"')","background-size":"100%"})}c.b("#0").e("hidden");c.b("#0").c("mostrar");p(c);r(c);c.data("panelON",!1);b("#ReadThisPanel").a({height:40,width:"100%",position:"absolute",left:0,bottom:0,"z-index":9001,opacity:0,"background-color":"rgba(0,0,0,0.7)"});b("#ReadThisPanel").append("<div id='RTfscreen'></div>");b("#RTfscreen").a({"background-image":"url('http://sliderpro.net/wp-content/uploads/icons/fullscreen.png')","background-size":"100%",width:32,height:32,"float":"right",
"margin-right":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTzoom'></div>");b("#RTzoom").a({"background-image":"url('img/zoomIcon.png')","background-size":"100%",width:32,height:32,"float":"left","margin-left":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTzoomlvl'></div>");b("#RTzoomlvl").a({"background-image":"url('img/arrow-downIcon.png')","background-size":"100%",width:10,height:32,"float":"left","margin-left":5,"margin-top":5});b("#ReadThisPanel").append("<div id='RTprogbar'><div id='progtext'></div><div id='progbar'><span></span></div></div>");
b("#progtext").a({color:"#FFFFFF","float":"left","font-family":"Helvetica","margin-right":"5px","margin-top":"10px"});b("#progtext").text("1/"+c.data("cantPags"));c.data("pagActual",1);b("#progbar").a({height:8,width:350,"margin-top":17,"float":"left","background-color":"#3F0000"});b("#progbar span").a({height:8,width:0,"float":"left","background-color":"#FF0000"});b("#RTprogbar").a({height:32,position:"absolute",left:(c.data("opciones").width-b("#progbar").width())/2})}},200))};b.s.p=function(a){var c=
this.data("opciones").k.length-1;"single"==this.data("opciones").j?"right"==a&&this.b(".mostrar").h("id")!=c?(this.b(".mostrar").next().c("proximo"),this.b(".mostrar").c("hidden"),this.b(".mostrar").e("mostrar"),this.b(".proximo").c("mostrar"),this.b(".proximo").e("hidden"),this.b(".proximo").e("proximo"),this.data("pagActual",this.data("pagActual")+1)):"left"==a&&0!=this.b(".mostrar").h("id")&&(this.b(".mostrar").n().c("proximo"),this.b(".mostrar").c("hidden"),this.b(".mostrar").e("mostrar"),this.b(".proximo").c("mostrar"),
this.b(".proximo").e("hidden"),this.b(".proximo").e("proximo"),this.data("pagActual",this.data("pagActual")-1)):"right"==a&&this.b(".mostrar").m().h("id")!=c?(this.b(".mostrar").m().next().c("proximo"),this.b(".mostrar").m().next().d("doble")||this.b(".proximo").next().c("proximo"),this.b(".mostrar").i(function(){b(this).c("hidden");b(this).e("mostrar")}),this.b(".proximo").i(function(){b(this).c("mostrar")}),this.b(".proximo").i(function(){b(this).e("hidden");b(this).e("proximo")}),this.data("pagActual",
this.data("pagActual")+1)):"left"==a&&0!=this.b(".mostrar").first().h("id")&&(this.b(".mostrar").first().n().c("proximo"),this.b(".mostrar").first().n().d("doble")||0==this.b(".mostrar").first().n().h("id")||this.b(".proximo").n().c("proximo"),this.b(".mostrar").i(function(){b(this).c("hidden");b(this).e("mostrar")}),this.b(".proximo").i(function(){b(this).c("mostrar")}),this.b(".proximo").i(function(){b(this).e("hidden");b(this).e("proximo")}),this.data("pagActual",this.data("pagActual")-1));b("#progtext").text(this.data("pagActual")+
"/"+this.data("cantPags"));b("#progbar span").a("width",(this.data("pagActual")-1)/(this.data("cantPags")-1)*b("#progbar").width());m(this)}})(jQuery);